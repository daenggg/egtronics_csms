<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="">
        <meta name="author" content="">
        <meta name="generator" content="">
        <title>단가 정보</title>

        <script type="text/javascript" src="https://code.jquery.com/jquery-latest.min.js" ></script>
        <link href="https://kendo.cdn.telerik.com/2020.3.915/styles/kendo.common.min.css" rel="stylesheet" />
        <link href="https://kendo.cdn.telerik.com/2020.3.915/styles/kendo.default.min.css" rel="stylesheet" />
        <script src="https://code.jquery.com/jquery-1.12.3.min.js"></script>
        <script src="../kendo/kendo.all.min.js"></script>
        <script src="../kendo/jszip.min.js"></script>
        <script src="../kendo/cultures/kendo.culture.ko-KR.min.js"></script>
        <!-- Bootstrap core CSS -->
        <link href="../assets/dist/css/bootstrap.min.css" rel="stylesheet">
        <link href="../dashboard.css" rel="stylesheet">
        <style>
          
        </style>
        
      </head>
      
      <body style="background-color: rgb(255, 255, 255)">
        <header class="navbar navbar-dark sticky-top flex-md-nowrap p-0 shadow" style="background-color: white;">
            <a class="navbar-brand col-md-3 col-lg-2 me-0 px-3" href="../main/main.html">
                <img src="../assets/brand/eglogo.png" class="img-fluid logo-img" alt="이지트로닉스 로고">
            </a>
            <div class="navbar-nav">
                <button type="button" class="btn-logout">
                    <a class="nav-link" href="../home/login.html" style="color:black">
                        <i class="fas fa-sign-out-alt"></i> 로그아웃
                    </a>
                </button>
            </div>
        </header>
        
        <div class="container-fluid">
          <div class="side-bar">
            <div class="side-bar__icon-box">
                <div class="side-bar__icon-1" id="toggle-sidebar">
                    <div></div>
                    <div></div>
                    <div></div>
                </div>
            </div>
            <div id="navMenu"></div> <!-- 네비게이션 메뉴를 추가하는 부분 -->
        </div>
      
          <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
            <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
              <h1 class="h2">충전 요금 관리</h1>
            </div>
              <div id="gridDiv"></div> 
          </main>
        </div>
      </body>
</html>

<script src="../practice.js"></script>
<script >
   $(document).ready(function() {
        var t = sessionStorage.getItem('accessToken');
        sessionStorage.setItem('companyCode', "");
        var contentData = [];

        // sessionStorage에서 'menuData' 키로 저장된 데이터를 가져와 JSON 객체로 파싱
        let retrievedArray = JSON.parse(sessionStorage.getItem('menuData'));
        console.log(retrievedArray);

        // 필터링된 네비게이션 항목을 저장할 빈 배열 선언
        var navItems = [];
        var subNavItems = []; // 2차 메뉴를 저장할 배열

        // retrievedArray의 각 항목을 순회
        for (var i = 0; i < retrievedArray.length; i++) {
            // 항목의 permit_r가 true이고 useYn이 "Y"인지 확인
            if (retrievedArray[i].permit_r === true && retrievedArray[i].useYn === "Y") {
                // parentMenuId가 0이면 1차 메뉴에 추가
                if (retrievedArray[i].parentMenuId == 0) {
                    navItems.push(retrievedArray[i]);
                } 
                // parentMenuId가 0이 아니면 2차 메뉴에 추가
                else {
                    subNavItems.push(retrievedArray[i]);
                }
            }
    }

        createNavMenu(navItems, subNavItems);

    $.ajax({    			
        url: reqURL+"/cost/info/list",
        type: "GET",
        dataType: "json", 
        contentType: "application/json",
        timeout: 5000, // 타임 아웃 설정
        beforeSend: function (xhr) {
            xhr.setRequestHeader("Authorization","Bearer " + t);
            xhr.setRequestHeader("menuId","9");
            xhr.setRequestHeader("permit","r");
        },
        success: function(data, textStatus, xhr) {
            
            var content =  data.payload;
            console.log(content);
            for(var i = 0; i < content.length; i ++) {
                var test = 
                {
                  companyCode : content[i].companyCode ,
                  hour0 : content[i].hour0 + "원",
                  hour1 : content[i].hour1 + "원",
                  hour2 : content[i].hour2 + "원"+ "원",
                  hour3 : content[i].hour3 + "원",
                  hour4 : content[i].hour4 + "원",
                  hour5 : content[i].hour5 + "원",
                  hour6 : content[i].hour6 + "원",
                  hour7 : content[i].hour7 + "원",
                  hour8 : content[i].hour8 + "원",
                  hour9 : content[i].hour9 + "원",
                  hour10 : content[i].hour10 + "원",
                  hour11 : content[i].hour11 + "원",
                  hour12 : content[i].hour12 + "원",
                  hour13 : content[i].hour13 + "원",
                  hour14 : content[i].hour14 + "원",
                  hour15 : content[i].hour15 + "원",
                  hour16 : content[i].hour16 + "원",
                  hour17 : content[i].hour17 + "원",
                  hour18 : content[i].hour18+ "원",
                  hour19 : content[i].hour19 + "원",
                  hour20 : content[i].hour20 + "원",
                  hour21 : content[i].hour21 + "원",
                  hour22 : content[i].hour22 + "원",
                  hour23 : content[i].hour23 + "원",
                  modDate : content[i].modDate ,
                  modUserId : content[i].modUserId ,
                  regDate : content[i].regDate ,
                  regUserId : content[i].regUserId ,
                }
                contentData.push(test);
            }
            $("#gridDiv").kendoGrid({
              dataBound: dataBound,
              columnMenu: {
                    filterable: false
                },
              dataSource: {
                data:contentData,
                pageSize: 10,
                pageable: {
                  input: true,
                },
              filterable: true,
              editable: true,
              },
              noRecords: true,
              scrollable: true,
              sortable: true,
              batch: true,
              selectable: true,
              pageable:true,
            toolbar: [
                { text: "select", template: '<a class="k-button" href="\\#" onclick="return btnCostInsert()">등록</a>' }, //&nbsp;
                { text: "select", template: '<a class="k-button" href="\\#" onclick="return btnCostUpdate()">수정</a>' } //&nbsp;
            ],
            columns: [
            { field: 'companyCode', title: '<strong>CPO 코드', headerAttributes: {style: "text-align: center;"}, attributes: { "class": "table-cell", style: "text-align: center;" }, width: 120},
            { field: 'hour0', title: '<strong>00시 충전 요금', headerAttributes: {style: "text-align: center;"}, attributes: { "class": "table-cell", style: "text-align: center;" },width: 150,}, 
              { field: 'hour1', title: '<strong>01시 충전 요금', headerAttributes: {style: "text-align: center;"}, attributes: { "class": "table-cell", style: "text-align: center;" },width: 150 ,},
              { field: 'hour2', title: '<strong>02시 충전 요금', headerAttributes: {style: "text-align: center;"}, attributes: { "class": "table-cell", style: "text-align: center;" },width: 150 ,},
              { field: 'hour3', title: '<strong>03시 충전 요금', headerAttributes: {style: "text-align: center;"}, attributes: { "class": "table-cell", style: "text-align: center;" },width: 150 , },
            { field: 'hour4', title: '<strong>04시 충전 요금', headerAttributes: {style: "text-align: center;"}, attributes: { "class": "table-cell", style: "text-align: center;" },width: 150 , },
            { field: 'hour5', title: '<strong>05시 충전 요금', headerAttributes: {style: "text-align: center;"}, attributes: { "class": "table-cell", style: "text-align: center;" },width: 150 , },
            { field: 'hour6', title: '<strong>06시 충전 요금', headerAttributes: {style: "text-align: center;"}, attributes: { "class": "table-cell", style: "text-align: center;" },width: 150 , },
            { field: 'hour7', title: '<strong>07시 충전 요금', headerAttributes: {style: "text-align: center;"}, attributes: { "class": "table-cell", style: "text-align: center;" },width: 150 , },
            { field: 'hour8', title: '<strong>08시 충전 요금', headerAttributes: {style: "text-align: center;"}, attributes: { "class": "table-cell", style: "text-align: center;" },width: 150 , },
            { field: 'hour9', title: '<strong>09시 충전 요금', headerAttributes: {style: "text-align: center;"}, attributes: { "class": "table-cell", style: "text-align: center;" },width: 150 , },
            { field: 'hour10', title: '<strong>10시 충전 요금', headerAttributes: {style: "text-align: center;"}, attributes: { "class": "table-cell", style: "text-align: center;" },width: 150 , },
            { field: 'hour11', title: '<strong>11시 충전 요금', headerAttributes: {style: "text-align: center;"}, attributes: { "class": "table-cell", style: "text-align: center;" },width: 150, },
            { field: 'hour12', title: '<strong>12시 충전 요금', headerAttributes: {style: "text-align: center;"}, attributes: { "class": "table-cell", style: "text-align: center;" },width: 150 , },
            { field: 'hour13', title: '<strong>13시 충전 요금', headerAttributes: {style: "text-align: center;"}, attributes: { "class": "table-cell", style: "text-align: center;" },width: 150, },
            { field: 'hour14', title: '<strong>14시 충전 요금', headerAttributes: {style: "text-align: center;"}, attributes: { "class": "table-cell", style: "text-align: center;" },width: 150, },
            { field: 'hour15', title: '<strong>15시 충전 요금', headerAttributes: {style: "text-align: center;"}, attributes: { "class": "table-cell", style: "text-align: center;" },width: 150,},
            { field: 'hour16', title: '<strong>16시 충전 요금', headerAttributes: {style: "text-align: center;"}, attributes: { "class": "table-cell", style: "text-align: center;" },width: 150, },
            { field: 'hour17', title: '<strong>17시 충전 요금', headerAttributes: {style: "text-align: center;"}, attributes: { "class": "table-cell", style: "text-align: center;" },width: 150, },
            { field: 'hour18', title: '<strong>18시 충전 요금', headerAttributes: {style: "text-align: center;"}, attributes: { "class": "table-cell", style: "text-align: center;" },width: 150, },
            { field: 'hour19', title: '<strong>19시 충전 요금', headerAttributes: {style: "text-align: center;"}, attributes: { "class": "table-cell", style: "text-align: center;" },width: 150, },
            { field: 'hour21', title: '<strong>21시 충전 요금', headerAttributes: {style: "text-align: center;"}, attributes: { "class": "table-cell", style: "text-align: center;" },width: 150, },
            { field: 'hour22', title: '<strong>22시 충전 요금', headerAttributes: {style: "text-align: center;"}, attributes: { "class": "table-cell", style: "text-align: center;" },width: 150, },
            { field: 'hour23', title: '<strong>23시 충전 요금', headerAttributes: {style: "text-align: center;"}, attributes: { "class": "table-cell", style: "text-align: center;" },width: 150, },
            { field: 'regDate ', title:  '<strong>등록 일시', headerAttributes: {style: "text-align: center;"}, attributes: { "class": "table-cell", style: "text-align: center;" },width: 200, template: "#= kendo.toString(kendo.parseDate(regDate), 'yyyy-MM-dd HH:mm') #" },
            { field: 'regUserId ', title:  '<strong>등록자',headerAttributes: {style: "text-align: center;"}, attributes: { "class": "table-cell", style: "text-align: center;" },width: 120 },
            { field: 'modDate ', title:  '<strong>수정 일시', headerAttributes: {style: "text-align: center;"}, attributes: { "class": "table-cell", style: "text-align: center;" }, width: 200, template: "#= kendo.toString(kendo.parseDate(regDate), 'yyyy-MM-dd HH:mm') #" },
            { field: 'modUserId ', title:  '<strong>수정자', headerAttributes: {style: "text-align: center;"}, attributes: { "class": "table-cell", style: "text-align: center;" }, width: 120 },
            ],
            });
            
        },
        error: function(error) {
            alert('실패: ' + error.responseText);
        }
    });
});

function btnCostInsert(){
  window.open("chargerCostInsert.html", "충전 요금 등록", "width=750, height=1500, top=150, left=200");
}

function btnCostUpdate(){
  Code_Check();
  var data = sessionStorage.getItem('companyCode');
  if(data == "" ||data == null){
    alert('수정할 곳을 선택하여 주세요');
  }
  else{
    window.open("chargerCostUpdate.html", "충전 요금 수정", "width=750, height=1500, top=150, left=200");
  }
  
}


function Code_Check(){
  var grid = $("#gridDiv").data("kendoGrid");
  var rows = grid.select();
  var selectedIds = [];

  $(rows).each(function(){
    var dataItem = grid.dataItem(this);
    selectedIds.push(dataItem);
    for(var i in selectedIds) {
      sessionStorage.setItem('companyCode', selectedIds[i].companyCode);
      //console.log("[충전 수정] : " + selectedIds[i].companyCode);
    }
  });
}

function dataBound(e) {
    var _width = 1800;
    var grid_data = $("#gridDiv").data("kendoGrid");

    grid_data.thead.closest('table').width(_width);
    grid_data.tbody.closest('table').width(_width);
}
document.addEventListener('DOMContentLoaded', function() {
        initializeSidebar(); // practice.js에서 정의한 함수 호출
    });
</script>