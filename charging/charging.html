<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="">
        <meta name="author" content="">
        <meta name="generator" content="">
        <title>충전 정보</title>
    
        <script type="text/javascript" src="https://code.jquery.com/jquery-latest.min.js" ></script>
        <link href="https://kendo.cdn.telerik.com/2020.3.915/styles/kendo.common.min.css" rel="stylesheet" />
        <link href="https://kendo.cdn.telerik.com/2020.3.915/styles/kendo.default.min.css" rel="stylesheet" />
        <script src="https://code.jquery.com/jquery-1.12.3.min.js"></script>
        <script src="../kendo/kendo.all.min.js"></script>
        <script src="../kendo/jszip.min.js"></script>
        <script src="../kendo/cultures/kendo.culture.ko-KR.min.js"></script>
        <!-- Bootstrap core CSS -->
        <link href="../assets/dist/css/bootstrap.min.css" rel="stylesheet">
        <link rel="stylesheet" href="../dashboard.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    </head>
      <header class="navbar navbar-dark sticky-top flex-md-nowrap p-0 shadow" style="background-color: white;">
        <a class="navbar-brand col-md-3 col-lg-2 me-0 px-3" href="../main/main.html">
            <img src="../assets/brand/eglogo.png" class="img-fluid logo-img" alt="이지트로닉스 로고">
        </a>
        <div class="navbar-nav">
          <button type="button" class="btn-logout">
            <a class="nav-link" href="../home/login.html" style="color:black">
              <i class="fas fa-sign-out-alt"></i> 로그아웃
            </a>
          </button>
        </div>
  </header>
        
  <div class="container-fluid">
    <nav id="navMenu" class = "side-bar">
        <section class="side-bar__icon-box">
            <section class="side-bar__icon-1" id="toggle-sidebar">
              <div></div>
              <div></div>
              <div></div>
            </section>
          </section>
        <p>
    </nav>
        
          <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
            <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
              <h1 class="h2">충전 내역 관리</h1>
            </div>
            <div id="gridDiv"></div>
          </main>
          
        </div>
      </body>
</html>

<script src="../practice.js"></script>
<script >
$(document).ready(function () {
  var t = sessionStorage.getItem('accessToken');
  var contentData = [];
  // sessionStorage에서 'menuData' 키로 저장된 데이터를 가져와 JSON 객체로 파싱
  let retrievedArray = JSON.parse(sessionStorage.getItem('menuData'));
        console.log(retrievedArray);

        // 필터링된 네비게이션 항목을 저장할 빈 배열 선언
        var navItems = [];
        // retrievedArray의 각 항목을 순회
        for (var i = 0; i < retrievedArray.length; i++) {
        // 항목의 permit_r가 true이고 useYn이 "Y"인지 확인
        if (retrievedArray[i].permit_r === true && retrievedArray[i].useYn === "Y") {
            // 조건을 만족하는 항목의 menuName을 navItems 배열에 추가
            navItems.push(retrievedArray[i].menuName);
        }
        }
        console.log(navItems);

        // navItems 배열의 각 항목에 대해 반복
        navItems.forEach((item, index) => {
        // navItems[6], [7]을 건너뛰기 위해 체크
        if (index === 6 || index === 7) return;

        // navItems[16]~[24]를 건너뛰기 위해 체크
        if (index >= 16 && index <= 22) return;

        const ul = document.createElement('ul');
        const li1 = document.createElement('li');
        const a1 = document.createElement('a');
        a1.textContent = item; // 링크 텍스트 설정
        a1.href = href_link(item); // href 속성 설정
        li1.appendChild(a1);

        // navItems[5]에 대해 2차 메뉴 생성
        if (index === 5) {
            const nestedUl1 = document.createElement('ul');

            // 2차 메뉴 항목 추가
            [6, 7].forEach(subIndex => {
            const nestedLi = document.createElement('li');
            const nestedA = document.createElement('a');
            nestedA.textContent = navItems[subIndex]; // 링크 텍스트 설정
            nestedA.href = href_link(navItems[subIndex]); // href 속성 설정
            nestedLi.appendChild(nestedA);
            nestedUl1.appendChild(nestedLi);
            });

            li1.appendChild(nestedUl1);
        }

        // navItems[15]에 대해 2차 메뉴 생성
        if (index === 15) {
            const nestedUl1 = document.createElement('ul');

            for (let i = 16; i <= 22; i++) {
            const nestedLi = document.createElement('li');
            const nestedA = document.createElement('a');
            nestedA.textContent = navItems[i]; // 링크 텍스트 설정
            nestedA.href = href_link(navItems[i]); // href 속성 설정
            nestedLi.appendChild(nestedA);
            nestedUl1.appendChild(nestedLi);
            }

            li1.appendChild(nestedUl1);
        }

        ul.appendChild(li1);
        navMenu.appendChild(ul);
        });
    
       $.ajax({    			
        url: reqURL+"/transaction/info/page/list?page=1&size=1000&order=Descending&by=transactionId",
        type: "GET",
        dataType: "json", 
        contentType: "application/json",
        timeout: 5000, // 타임 아웃 설정
        beforeSend: function (xhr) {
            xhr.setRequestHeader("Authorization","Bearer " + t);
            xhr.setRequestHeader("menuId","15");
            xhr.setRequestHeader("permit","r");
        },
        success: function(data, textStatus, xhr) {
           // console.log("[data] : " + JSON.stringify(data));
            var content =  data.payload.content;
            for(var i = 0; i < content.length; i ++) {
                var start_kWh= Wh_JSONformat(content[i].startChargingWh);
                var stop_kWh= Wh_JSONformat(content[i].stopChargingWh);
                var total_kWh= Wh_JSONformat(content[i].totalChargedWh);
                var Amount= won_JSONformat(content[i].chargingAmount);
                var start_Soc= SOC_JSONformat(content[i].startSoc);
                var end_Soc= SOC_JSONformat(content[i].endSoc);
                var remote_StartDt = NULL_JSONformat(content[i].remoteStartDt);
                var remote_StopDt = NULL_JSONformat(content[i].remoteStopDt);
                var test = 
                {
                  transactionId : content[i].transactionId,
                  stationId : content[i].stationId,
                  chargerId : content[i].chargerId,
                  connectorId : content[i].connectorId,
                  rfCardNo : content[i].rfCardNo,
                  updateDt : content[i].updateDt,
                  startDt : content[i].startDt,
                  stopDt : content[i].stopDt,
                  startChargingWh : start_kWh,
                  stopChargingWh : stop_kWh,
                  totalChargedWh : total_kWh,
                  chargingAmount : Amount,
                  startSoc : start_Soc,
                  endSoc : end_Soc,
                  remoteStartDt : remote_StartDt,
                  remoteStopDt : remote_StopDt,
                }
                contentData.push(test);
            }
            $("#gridDiv").kendoGrid({
              dataBound: dataBound,
              columnMenu: {
                    filterable: false
                },
              dataSource: {
                data:contentData,
                pageSize: 10,
                pageable: {
                  input: true,
                },
              filterable: true,
              editable: true,
              },
              noRecords: true,
              scrollable: true,
              sortable: true,
              batch: true,
              selectable: true,
              pageable:true,
            toolbar: [
            { template:'<a>충전 정보</a>'}
            ],
            columns: [
                { field: 'transactionId', title: '<strong>충전 ID', headerAttributes: {style: "text-align: center;"}, attributes: { "class": "table-cell", style: "text-align: center;" }, width: 100},
                { field: 'stationId', title: '<strong>충전소 ID',headerAttributes: {style: "text-align: center;"}, attributes: { "class": "table-cell", style: "text-align: center;" }, width: 120},
                { field: 'chargerId', title: '<strong>충전기 ID', headerAttributes: {style: "text-align: center;"}, attributes: { "class": "table-cell", style: "text-align: center;" }, width: 110},
                { field: 'connectorId', title: '<strong>커넥터 ID', headerAttributes: {style: "text-align: center;"}, attributes: { "class": "table-cell", style: "text-align: center;" }, width: 110 },
                { field: "rfCardNo", title: "<strong>회원 정보", headerAttributes: {style: "text-align: center;"}, attributes: { "class": "table-cell", style: "text-align: center;" }, width: 150},
                { field: "updateDt", title: "<strong>마지막 전송 일시", headerAttributes: {style: "text-align: center;"}, attributes: { "class": "table-cell", style: "text-align: center;" }, width: 180, template: "#= kendo.toString(kendo.parseDate(updateDt), 'yyyy-MM-dd HH:mm') #"  },
                { field: "startDt", title: "<strong>충전 시작 일시", headerAttributes: {style: "text-align: center;"}, attributes: { "class": "table-cell", style: "text-align: center;" }, width: 180, template: "#= kendo.toString(kendo.parseDate(startDt), 'yyyy-MM-dd HH:mm') #" },
                { field: "stopDt", title: "<strong>충전 종료 일시", headerAttributes: {style: "text-align: center;"}, attributes: { "class": "table-cell", style: "text-align: center;" }, width: 180, template: "#= kendo.toString(kendo.parseDate(stopDt), 'yyyy-MM-dd HH:mm') #"  },
                { field: "startChargingWh", title: "<strong>시작 전력량", headerAttributes: {style: "text-align: center;"}, attributes: { "class": "table-cell", style: "text-align: center;" }, width: 140  },
                { field: "stopChargingWh", title: "<strong>종료 전력량", headerAttributes: {style: "text-align: center;"}, attributes: { "class": "table-cell", style: "text-align: center;" }, width: 140  },
                { field: "totalChargedWh", title: "<strong>충전 전력량", headerAttributes: {style: "text-align: center;"}, attributes: { "class": "table-cell", style: "text-align: center;" }, width: 130  },
                { field: "chargingAmount", title: "<strong>충전 금액", headerAttributes: {style: "text-align: center;"}, attributes: { "class": "table-cell", style: "text-align: center;" }, width: 110},
                { field: "startSoc", title: "<strong>충전시작 SOC", headerAttributes: {style: "text-align: center;"}, attributes: { "class": "table-cell", style: "text-align: center;" }, width: 140 },
                { field: "endSoc", title: "<strong>충전종료 SOC", headerAttributes: {style: "text-align: center;"}, attributes: { "class": "table-cell", style: "text-align: center;" }, width: 140 },
                { field: "remoteStartDt", title: "<strong>원격 충전 시작 일시", headerAttributes: {style: "text-align: center;"}, attributes: { "class": "table-cell", style: "text-align: center;" }, width: 180, template: "#= kendo.toString(kendo.parseDate(remoteStartDt), 'yyyy-MM-dd HH:mm') #"  },
                { field: "remoteStopDt", title: "<strong>원격 충전 종료 일시", headerAttributes: {style: "text-align: center;"}, attributes: { "class": "table-cell", style: "text-align: center;" }, width: 180, template: "#= kendo.toString(kendo.parseDate(remoteStopDt), 'yyyy-MM-dd HH:mm') #"  },
            ],
            
        });
            
        },
        error: function(error) {
            alert('실패: ' + error.responseText);
        }
    });

});

function dataBound(e) {
    var _width = 1300;
    var grid_data = $("#gridDiv").data("kendoGrid");

    grid_data.thead.closest('table').width(_width);
    grid_data.tbody.closest('table').width(_width);
}

document.addEventListener('DOMContentLoaded', function() {
    const sidebar = document.querySelector('.side-bar');
    const toggleIcon = document.getElementById('toggle-sidebar');
    const mainContent = document.querySelector('main'); // 메인 콘텐츠 선택
    let isSidebarVisible = false; // 사이드바 상태를 저장할 변수
    mainContent.style.width = 'calc(100% - var(--side-bar-width) * 0.2)'; // 초기 상태에서 메인 콘텐츠 너비 조정

    if (isSidebarVisible) {
            // 사이드바 숨기기
            sidebar.style.transform = `translate(calc(var(--side-bar-width) * -0.8), 0)`;
            mainContent.style.width = 'calc(100% - var(--side-bar-width) * 0.2)'; // 메인 콘텐츠 넓이 늘리기
            
        } else {
            // 사이드바 보이기
            sidebar.style.transform = 'translate(0, 0)';
            mainContent.style.width = '88%'; // 메인 콘텐츠 넓이 원래대로
            isSidebarVisible = true;
        }

    toggleIcon.addEventListener('click', function() {
        if (isSidebarVisible) {
            // 사이드바 숨기기
            sidebar.style.transform = `translate(calc(var(--side-bar-width) * -0.8), 0)`;
            mainContent.style.width = 'calc(100% - var(--side-bar-width) * 0.2)'; // 메인 콘텐츠 넓이 늘리기
            isSidebarVisible = false;
        } else {
            // 사이드바 보이기
            sidebar.style.transform = 'translate(0, 0)';
            mainContent.style.width = '88%'; // 메인 콘텐츠 넓이 원래대로
            isSidebarVisible = true;
        }
        localStorage.setItem('isSidebarVisible', isSidebarVisible); // 상태 저장
    });
});
</script>