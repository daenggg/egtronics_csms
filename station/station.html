<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="">
        <meta name="author" content="">
        <meta name="generator" content="">
        <title>충전소 관리</title>

        <script type="text/javascript" src="https://code.jquery.com/jquery-latest.min.js" ></script>
        <link href="https://kendo.cdn.telerik.com/2020.3.915/styles/kendo.common.min.css" rel="stylesheet" />
        <link href="https://kendo.cdn.telerik.com/2020.3.915/styles/kendo.default.min.css" rel="stylesheet" />
        <script src="https://code.jquery.com/jquery-1.12.3.min.js"></script>
        <script src="../kendo/kendo.all.min.js"></script>
        <script src="../kendo/jszip.min.js"></script>
        <script src="../kendo/cultures/kendo.culture.ko-KR.min.js"></script>
        <!-- Bootstrap core CSS -->
        <link href="../assets/dist/css/bootstrap.min.css" rel="stylesheet">
        <link href="../dashboard.css" rel="stylesheet">
        <style>
          
        </style>
      </head>
      
      <body style="background-color: rgb(255, 255, 255)">
        <header class="navbar navbar-dark sticky-top bg-dark flex-md-nowrap p-0 shadow">
          <a class="navbar-brand col-md-3 col-lg-2 me-0 px-3" href="#">Egtronics</a>
          <div class="navbar-nav col-md-1">
              <a class="nav-link px-3" href="../home/login.html">Sign out</a>
          </div>
        </header>
        
        <div class="container-fluid">
          <nav id="navMenu" class="col-md-2 d-md-block sidebar collapse">
            <p>   
          </nav>
      
          <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
            <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
              <h1 class="h2">충전소 화면</h1>
            </div>
            <div id="gridDiv"></div>
          </main>
        </div>
      </body>
</html>

  <script src="../practice.js"></script>
<script >
$(document).ready(function () {
  var t = sessionStorage.getItem('accessToken');
  sessionStorage.setItem('stationId', "");
  var contentData = [];
  let retrievedArray = JSON.parse(sessionStorage.getItem('menuData'));
  var navItems  = [];
  for(var i = 0; i < retrievedArray.length; i ++) {
    if(retrievedArray[i].permit_r == true && retrievedArray[i].useYn =="Y" )
    {
      navItems.push(retrievedArray[i].menuName);
    }
  }
      
  navItems.forEach(item => {
      const navLink = document.createElement('a'); // <a> 태그 생성
      navLink.textContent = item; // 링크 텍스트 설정
      navLink.href = href_link(item); // href 속성 설정
      navMenu.appendChild(navLink); 
    });
  
       $.ajax({    			
        url: reqURL+"/station/info/page/list?page=1&size=10000",
        type: "GET",
        dataType: "json", 
        contentType: "application/json",
        timeout: 5000, // 타임 아웃 설정
        beforeSend: function (xhr) {
            xhr.setRequestHeader("Authorization","Bearer " + t);
            xhr.setRequestHeader("menuId","13");
            xhr.setRequestHeader("permit","r");
        },
        success: function(data, textStatus, xhr) {
          console.log("[data] : " + JSON.stringify(data));
            var content =  data.payload.content;
            for(var i = 0; i < content.length; i ++) {
                var test = 
                {
                  stationId : content[i].stationId,
                  stationName : content[i].stationName,
                  companyName : content[i].companyName,
                  companyCode : content[i].companyCode,
                  stationAddrCity : content[i].stationAddrCity,
                  stationAddrCountry : content[i].stationAddrCountry,
                  stationAddrTown : content[i].stationAddrTown,
                  stationAddrRoadname : content[i].stationAddrRoadname,
                  stationAddrDetail : content[i].stationAddrRoadname,
                  stationFloor : content[i].stationFloor,
                  stationZone : content[i].stationZone,
                  stationGpsX : content[i].stationGpsX,
                  stationGpsY : content[i].stationGpsY,
                  stationContractCapacity : content[i].stationContractCapacity,
                  useYn : content[i].useYn,
                }
                contentData.push(test);
            }
            $("#gridDiv").kendoGrid({
              dataBound: dataBound,
              columnMenu: {
                    filterable: false
                },
              dataSource: {
                data:contentData,
                pageSize: 10,
                pageable: {
                  input: true,
                },
              filterable: true,
              editable: true,
              },
              noRecords: true,
              scrollable: true,
              sortable: true,
              batch: true,
              selectable: true,
              pageable:true,
            toolbar: [
                { text: "select", template: '<a class="k-button" href="\\#" onclick="return btnStationInsert()"></span>&nbsp충전소 추가</a>' },
                { text: "select", template: '<a class="k-button" href="\\#" onclick="return btnStationUpdate()"></span>&nbsp충전소 수정</a>' },
            ],
            columns: [
                { field: 'companyName', title: '사업자 이름', attributes: { "class": "table-cell", style: "text-align: center;" },width: 150 },
                { field: 'stationId', title: '충전소 ID', attributes: { "class": "table-cell", style: "text-align: center;" },width: 130 },
                { field: 'stationName', title: '충전소 이름', attributes: { "class": "table-cell", style: "text-align: center;" },width: 220 },
                { field: 'stationAddrCity', title: '주소1', width: 120 },
                { field: "stationAddrCountry", title: "주소2",width: 120 },
                { field: "stationAddrTown", title: "주소3", width: 130},
                { field: "stationAddrRoadname", title: "주소4",width: 150 },
                { field: "stationAddrDetail", title: "주소5", width: 150 },
                { field: "stationFloor", title: "위치", width: 150 },
                { field: "stationZone", title: "위치2", width: 150 },
                { field: "stationGpsX", title: "GPS X",width: 100 },
                { field: "stationGpsY", title: "GPS Y",width: 100 },
                //{ field: "stationContractCapacity", title: "수주 용량",width: 120 },
                { field: "useYn", title: "사용여부",width: 100 },

            ],
            });
        },
        error: function(error) {
            alert('실패: ' + error.responseText);
        }
    });
});

function btnStationInsert(){
  window.open("StationInsert.html", "충전소 등록", "width=600, height=850, top=150, left=200");
}

function btnStationUpdate(){
  Station_Check();
  var data = sessionStorage.getItem('stationId');
  if(data == "" ||data == null){
    alert('수정할 곳을 선택하여 주세요');
  }
  else{
    window.open("StationUpdate.html", "충전소 수정", "width=600, height=850, top=150, left=200");
  }
}

function Station_Check(){
  var grid = $("#gridDiv").data("kendoGrid");
  var rows = grid.select();
  var selectedIds = [];

  $(rows).each(function(){
    var dataItem = grid.dataItem(this);
    selectedIds.push(dataItem);
    for(var i in selectedIds) {
      sessionStorage.setItem('stationId', selectedIds[i].stationId);
    }
  });
}

function dataBound(e) {
    var _width = 1800;
    var grid_data = $("#gridDiv").data("kendoGrid");

    grid_data.thead.closest('table').width(_width);
    grid_data.tbody.closest('table').width(_width);
}
</script>